{"version":3,"file":"esurksha-1.0.0.min.js","sources":["../src/config.js","../src/api.js","../src/store.js","../src/script-manager.js","../src/index.js","../src/banner.js"],"sourcesContent":["let CONFIG = {}\r\n\r\nexport function setConfig(config) {\r\n  CONFIG = config\r\n}\r\n\r\nexport function getConfig() {\r\n  return CONFIG\r\n}\r\n","import { getConfig } from './config.js'\r\n\r\nexport async function fetchPurposes() {\r\n  const { apiBaseUrl, tenantId, token } = getConfig()\r\n\r\n  const res = await fetch(`${apiBaseUrl}/user/consents/purposes`, {\r\n    headers: {\r\n      'Authorization': `Bearer ${token}`,\r\n      'x-tenant-id': tenantId\r\n    }\r\n  })\r\n\r\n  return res.json()\r\n}\r\n\r\nexport async function fetchUserConsents() {\r\n  const { apiBaseUrl, tenantId, token } = getConfig()\r\n\r\n  const res = await fetch(`${apiBaseUrl}/user/consents`, {\r\n    headers: {\r\n      'Authorization': `Bearer ${token}`,\r\n      'x-tenant-id': tenantId\r\n    }\r\n  })\r\n\r\n  return res.json()\r\n}\r\n\r\nexport async function submitConsent(code, granted) {\r\n  const { apiBaseUrl, tenantId, token } = getConfig()\r\n\r\n  return fetch(`${apiBaseUrl}/user/consents`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Authorization': `Bearer ${token}`,\r\n      'x-tenant-id': tenantId,\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify({\r\n      consentCode: code,\r\n      granted\r\n    })\r\n  })\r\n}\r\n","let CONSENTS = []\r\n\r\nexport function saveConsents(consents) {\r\n  CONSENTS = consents\r\n}\r\n\r\nexport function getConsents() {\r\n  return CONSENTS\r\n}\r\n\r\nexport function hasConsent(code) {\r\n  const c = CONSENTS.find(c => c.code === code)\r\n  return !!(\r\n    c &&\r\n    c.consent_given === true &&\r\n    !c.revoked_at\r\n  )\r\n}\r\n","import { hasConsent } from './store.js'\r\n\r\nexport function runConsentScripts() {\r\n  const scripts = document.querySelectorAll(\r\n    'script[type=\"text/plain\"][data-es-consent]'\r\n  )\r\n\r\n  scripts.forEach(script => {\r\n    const purposeCode = script.dataset.esConsent\r\n\r\n    if (!hasConsent(purposeCode)) {\r\n      return\r\n    }\r\n\r\n    const newScript = document.createElement('script')\r\n\r\n    // Copy attributes\r\n    Array.from(script.attributes).forEach(attr => {\r\n      if (attr.name !== 'type') {\r\n        newScript.setAttribute(attr.name, attr.value)\r\n      }\r\n    })\r\n\r\n    newScript.src = script.src\r\n    newScript.async = true\r\n\r\n    script.parentNode.replaceChild(newScript, script)\r\n  })\r\n}\r\n","import { setConfig } from './config.js'\r\nimport { fetchPurposes, fetchUserConsents } from './api.js'\r\nimport { showBanner } from './banner.js'\r\nimport { saveConsents, getConsents } from './store.js'\r\n\r\nimport { runConsentScripts } from './script-manager.js'\r\n\r\n\r\nasync function init(config) {\r\n  setConfig(config)\r\n\r\n  const purposes = await fetchPurposes()\r\n  const userConsents = await fetchUserConsents()\r\n\r\n  saveConsents(userConsents)\r\n  runConsentScripts()\r\n\r\n  // Detect missing or outdated consent\r\n  const pending = purposes.filter(p => {\r\n    const consent = userConsents.find(u => u.code === p.code)\r\n    // No consent record → needs consent\r\n  if (!consent) return true\r\n\r\n  // Explicitly revoked → needs consent\r\n  if (!consent.consent_given) return true\r\n\r\n  // Version mismatch → needs re-consent\r\n  if (consent.consent_version < p.version) return true\r\n\r\n  return false\r\n  })\r\n\r\n  if (pending.length > 0) {\r\n    showBanner(pending)\r\n  }\r\n}\r\n\r\nexport default{\r\n  init\r\n}","import { submitConsent } from './api.js'\r\nimport { runConsentScripts } from './script-manager.js'\r\n\r\n\r\nexport function showBanner(purposes) {\r\n  const banner = document.createElement('div')\r\n  banner.style = `\r\n    position: fixed;\r\n    bottom: 0;\r\n    width: 100%;\r\n    background: #111;\r\n    color: #fff;\r\n    padding: 20px;\r\n    z-index: 9999;\r\n  `\r\n\r\n  banner.innerHTML = `\r\n    <h3>Privacy Preferences</h3>\r\n    ${purposes.map(p => `\r\n      <label>\r\n        <input type=\"checkbox\" data-code=\"${p.code}\">\r\n        ${p.description}\r\n      </label><br/>\r\n    `).join('')}\r\n    <button id=\"es-save\">Save</button>\r\n  `\r\n\r\n  document.body.appendChild(banner)\r\n\r\n  document.getElementById('es-save').onclick = async () => {\r\n    const inputs = banner.querySelectorAll('input[type=checkbox]')\r\n    for (const input of inputs) {\r\n      await submitConsent(input.dataset.code, input.checked)\r\n    }\r\n    banner.remove()\r\n    runConsentScripts()\r\n  }\r\n}\r\n"],"names":["CONFIG","getConfig","async","submitConsent","code","granted","apiBaseUrl","tenantId","token","fetch","method","headers","Authorization","body","JSON","stringify","consentCode","CONSENTS","runConsentScripts","document","querySelectorAll","forEach","script","c","find","consent_given","revoked_at","hasConsent","dataset","esConsent","newScript","createElement","Array","from","attributes","attr","name","setAttribute","value","src","parentNode","replaceChild","init","config","setConfig","purposes","json","fetchPurposes","userConsents","fetchUserConsents","pending","filter","p","consent","u","consent_version","version","length","banner","style","innerHTML","map","description","join","appendChild","getElementById","onclick","inputs","input","checked","remove","showBanner"],"mappings":"qCAAA,IAAIA,EAAS,CAAA,EAMN,SAASC,IACd,OAAOD,CACT,CCoBOE,eAAeC,EAAcC,EAAMC,GACxC,MAAMC,WAAEA,EAAUC,SAAEA,EAAQC,MAAEA,GAAUP,IAExC,OAAOQ,MAAM,GAAGH,kBAA4B,CAC1CI,OAAQ,OACRC,QAAS,CACPC,cAAiB,UAAUJ,IAC3B,cAAeD,EACf,eAAgB,oBAElBM,KAAMC,KAAKC,UAAU,CACnBC,YAAaZ,EACbC,aAGN,CC3CA,IAAIY,EAAW,GCER,SAASC,IACEC,SAASC,iBACvB,8CAGMC,QAAQC,IAGd,IDAG,SAAoBlB,GACzB,MAAMmB,EAAIN,EAASO,KAAKD,GAAKA,EAAEnB,OAASA,GACxC,SACEmB,IACoB,IAApBA,EAAEE,eACDF,EAAEG,WAEP,CCPSC,CAFeL,EAAOM,QAAQC,WAGjC,OAGF,MAAMC,EAAYX,SAASY,cAAc,UAGzCC,MAAMC,KAAKX,EAAOY,YAAYb,QAAQc,IAClB,SAAdA,EAAKC,MACPN,EAAUO,aAAaF,EAAKC,KAAMD,EAAKG,SAI3CR,EAAUS,IAAMjB,EAAOiB,IACvBT,EAAU5B,OAAQ,EAElBoB,EAAOkB,WAAWC,aAAaX,EAAWR,IAE9C,OCSc,CACZoB,KA9BFxC,eAAoByC,IJNb,SAAmBA,GACxB3C,EAAS2C,CACX,CIKEC,CAAUD,GAEV,MAAME,QHTD3C,iBACL,MAAMI,WAAEA,EAAUC,SAAEA,EAAQC,MAAEA,GAAUP,IASxC,aAPkBQ,MAAM,GAAGH,2BAAqC,CAC9DK,QAAS,CACPC,cAAiB,UAAUJ,IAC3B,cAAeD,MAIRuC,MACb,CGFyBC,GACjBC,QHGD9C,iBACL,MAAMI,WAAEA,EAAUC,SAAEA,EAAQC,MAAEA,GAAUP,IASxC,aAPkBQ,MAAM,GAAGH,kBAA4B,CACrDK,QAAS,CACPC,cAAiB,UAAUJ,IAC3B,cAAeD,MAIRuC,MACb,CGd6BG,GFT3BhC,EEWa+B,EACb9B,IAGA,MAAMgC,EAAUL,EAASM,OAAOC,IAC9B,MAAMC,EAAUL,EAAaxB,KAAK8B,GAAKA,EAAElD,OAASgD,EAAEhD,MAEtD,OAAKiD,KAGAA,EAAQ5B,eAGT4B,EAAQE,gBAAkBH,EAAEI,WAK5BN,EAAQO,OAAS,GC5BhB,SAAoBZ,GACzB,MAAMa,EAASvC,SAASY,cAAc,OACtC2B,EAAOC,MAAQ,gJAUfD,EAAOE,UAAY,2CAEff,EAASgB,IAAIT,GAAK,8DAEoBA,EAAEhD,mBACpCgD,EAAEU,0CAELC,KAAK,kDAIV5C,SAASN,KAAKmD,YAAYN,GAE1BvC,SAAS8C,eAAe,WAAWC,QAAUhE,UAC3C,MAAMiE,EAAST,EAAOtC,iBAAiB,wBACvC,IAAK,MAAMgD,KAASD,QACZhE,EAAciE,EAAMxC,QAAQxB,KAAMgE,EAAMC,SAEhDX,EAAOY,SACPpD,IAEJ,CDJIqD,CAAWrB,EAEf"}